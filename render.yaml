# Render Blueprint for deploying the record collection application
# Organized under Records project, Demo environment
# Uses starter service plan and basic-256mb database plan
#
# Note: This blueprint uses Bun runtime for the web service.
# The Dockerfile is provided for alternative Docker-based deployments.

projects:
  - name: Records
    environments:
      - name: Prod
        services:
          # Web service for the Next.js application
          - type: web
            name: my-record-collection
            runtime: node
            plan: starter
            region: oregon
            branch: main
            repo: https://github.com/lexpierce/my-record-collection
            healthCheckPath: /api/am_i_evil
            envVars:
              - key: NODE_ENV
                value: production
              - key: BUN_VERSION
                value: 1.3.9
              - key: DATABASE_URL
                fromDatabase:
                  name: my-record-collection-db
                  property: connectionString
              - key: DISCOGS_TOKEN
                sync: false
              - key: DISCOGS_USERNAME
                value: Lexpierce
              - key: DISCOGS_USER_AGENT
                value: MyRecordCollection/1.0
            buildFilter:
              ignoredPaths:
                - docs/**
                - "*.md"
                - tui/**
            # Bun is available by default on Render when BUN_VERSION is set
            buildCommand: bun install && bun run build
            startCommand: bun run start
            # Run database migrations before each deployment
            preDeployCommand: bun run db:migrate

        databases:
          # Postgres 18 database with 256MB RAM
          - name: my-record-collection-db
            plan: basic-256mb
            databaseName: my_record_collection
            region: oregon
            postgresMajorVersion: 18
            ipAllowList: []
